{
  "project": "review-agent-bug",
  "issueNumber": 19,
  "branchName": "ai/issue-19-review-agent-bug",
  "description": "Review Agent bug",
  "generatedAt": "2026-02-20T00:00:00Z",
  "status": "approved",
  "formula": "bugfix",
  "compaction": {
    "taskLogCountSinceLastSummary": 0,
    "summaryEveryNTaskLogs": 5
  },
  "userStories": [
    {
      "id": "US-001",
      "uid": "tsk_4bce0322e39d",
      "phase": 1,
      "priority": 1,
      "title": "Add _post_review_to_github helper to .claude/scripts/implement-loop.sh",
      "description": "Add a `_post_review_to_github()` helper function (placed before `spawn_task_review_agent`) that extracts the `## ðŸ”Ž Code Review:` block from captured output using awk and posts it to GitHub via `gh issue comment`. Call this helper in both the async subshell and sync paths of `spawn_task_review_agent`, after writing to the log file.",
      "files": [".claude/scripts/implement-loop.sh"],
      "dependsOn": [],
      "discoveredFrom": null,
      "discoverySource": null,
      "acceptanceCriteria": [
        "`_post_review_to_github` function exists in implement-loop.sh",
        "Function is called in both async and sync paths of spawn_task_review_agent",
        "`bash -n` syntax check passes on the file"
      ],
      "verifyCommands": [
        "count=$(grep -c \"_post_review_to_github\" .claude/scripts/implement-loop.sh); [ \"$count\" -ge 3 ] && echo \"OK: $count occurrences\" || (echo \"FAIL: only $count occurrences\"; exit 1)",
        "bash -n .claude/scripts/implement-loop.sh && echo \"syntax ok\""
      ],
      "passes": false,
      "attempts": 0,
      "lastAttempt": null
    },
    {
      "id": "US-002",
      "uid": "tsk_14a849eb76ce",
      "phase": 1,
      "priority": 2,
      "title": "Mirror fix to .agents/skills/issues-loop/scripts/implement-loop.sh",
      "description": "Apply the same `_post_review_to_github()` helper and call sites to the `.agents/` copy of implement-loop.sh, which has the same `spawn_task_review_agent` function with minor differences (severity levels, autoEnqueue defaults).",
      "files": [".agents/skills/issues-loop/scripts/implement-loop.sh"],
      "dependsOn": ["US-001"],
      "discoveredFrom": null,
      "discoverySource": null,
      "acceptanceCriteria": [
        "`_post_review_to_github` function exists in .agents copy",
        "Function called in both async and sync paths in .agents copy",
        "`bash -n` syntax check passes on .agents copy"
      ],
      "verifyCommands": [
        "count=$(grep -c \"_post_review_to_github\" .agents/skills/issues-loop/scripts/implement-loop.sh); [ \"$count\" -ge 3 ] && echo \"OK: $count occurrences\" || (echo \"FAIL: only $count occurrences\"; exit 1)",
        "bash -n .agents/skills/issues-loop/scripts/implement-loop.sh && echo \"syntax ok\""
      ],
      "passes": false,
      "attempts": 0,
      "lastAttempt": null
    }
  ],
  "globalVerifyCommands": [
    "bash -n .claude/scripts/implement-loop.sh && echo \"primary syntax ok\"",
    "bash -n .agents/skills/issues-loop/scripts/implement-loop.sh && echo \"agents syntax ok\""
  ]
}
