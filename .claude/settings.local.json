{
  "permissions": {
    "allow": [
      "WebFetch(domain:raw.githubusercontent.com)",
      "Bash(chmod:*)",
      "WebFetch(domain:github.com)",
      "Bash(curl:*)",
      "Bash(git init:*)",
      "Bash(git remote add:*)",
      "Bash(git branch:*)",
      "Bash(git fetch:*)",
      "Bash(git pull:*)",
      "Bash(git stash:*)",
      "Bash(git add:*)",
      "Bash(git commit -m \"$\\(cat <<''EOF''\nfeat: comprehensive codebase improvements \\(Ralph Pattern\\)\n\nPriority 1 - Determinism & Workflow Hardening:\n- Add prerequisite validation \\(Step 0\\) to all commands\n- Remove hidden session context from issue.md \\(violates fresh context\\)\n- Add file locking to implement-loop.sh \\(prevents prd.json corruption\\)\n- Improve result tag parsing \\(case-insensitive, whitespace handling\\)\n- Fix error handling \\(replace || true with proper exit code capture\\)\n\nPriority 2 - Ralph Pattern Alignment:\n- Add archive strategy to issue-close.md \\(archive/YYYY-MM-DD-issue-N-slug/\\)\n- Add codebase patterns section to implement.md\n- Add priority field to prd.json schema in planning-guide.md\n- Update implement-loop.sh to respect priority field\n- Create AGENTS.md template for directory patterns\n\nPriority 3 - Portability:\n- Create .issueloop.config.json configuration file\n- Add platform detection to install.sh \\(macos/linux/windows\\)\n- Add system requirements section to README.md\n- Create Dockerfile for containerization\n- Create archive/.gitkeep placeholder\n\nCo-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>\nEOF\n\\)\")",
      "Bash(git push:*)",
      "Bash(gh issue create --title \"Add /issue validate command to check workflow prerequisites\" --label \"AI\" --body \"$\\(cat <<''EOF''\n## Summary\n\nAdd a new `/issue validate` command that checks all prerequisites are properly configured before starting the workflow. This helps users catch setup issues early rather than failing mid-implementation.\n\n## What\n\nCreate a new command `.claude/commands/issue-validate.md` that:\n1. Checks all required tools are installed \\(gh, git, jq\\)\n2. Verifies gh CLI is authenticated\n3. Confirms we''re in a git repo with a GitHub remote\n4. Validates `.issueloop.config.json` exists and is valid JSON\n5. Checks if required labels exist on the repo\n6. Reports a summary of what''s ready vs what needs attention\n\n## Where\n\n- New file: `.claude/commands/issue-validate.md`\n- Update: `README.md` commands table to include the new command\n\n## Why\n\nUsers often hit cryptic errors when prerequisites aren''t met. A dedicated validation command provides:\n- Clear feedback on what''s missing\n- Actionable fix instructions\n- Confidence the workflow will run smoothly\n\n## Acceptance Criteria\n\n- [ ] `/issue validate` command exists and is documented\n- [ ] Command checks: gh installed, gh authenticated, git repo, GitHub remote, jq installed\n- [ ] Command checks: `.issueloop.config.json` exists and is valid\n- [ ] Command checks: required labels exist \\(AI, AI: Planning, etc.\\)\n- [ ] Output shows âœ… for passing checks, âŒ for failures with fix instructions\n- [ ] README.md commands table includes `/issue validate`\n\n## Scope\n\n- Only validation/checking - no auto-fix functionality\n- Focus on the checks defined in Step 0 Prerequisites across commands\n- Simple pass/fail output format\n\n## Example Output\n\n```\nðŸ” Validating Issue Loop Workflow Setup...\n\nTools:\n  âœ… gh CLI installed \\(v2.40.0\\)\n  âœ… gh authenticated as @mike-mauer\n  âœ… git installed \\(v2.39.0\\)\n  âœ… jq installed \\(v1.6\\)\n\nRepository:\n  âœ… Git repository detected\n  âœ… GitHub remote: mike-mauer/issues_loop\n  âœ… .issueloop.config.json found and valid\n\nLabels:\n  âœ… AI\n  âœ… AI: Planning\n  âœ… AI: Approved\n  âœ… AI: In Progress\n  âœ… AI: Testing\n  âœ… AI: Blocked\n  âœ… AI: Review\n  âœ… AI: Complete\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nâœ… All checks passed! Ready to use /issue workflow.\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n```\nEOF\n\\)\")",
      "Bash(gh label create:*)",
      "Bash(gh auth:*)",
      "Bash(git remote:*)",
      "Bash(gh issue view:*)",
      "Bash(gh issue create --title \"Enhance /issue command: post plan to GitHub + structured plan format\" --body \"$\\(cat <<''EOF''\n## Summary\nUpdate the `/issue` command to properly integrate native plan mode with the Ralph Pattern workflow. Currently, plans created in plan mode don''t get posted to GitHub issues or transformed into prd.json.\n\n## Background\nWhen `/issue N` invokes plan mode, the resulting plan should:\n1. Be posted to the GitHub issue as a `## ðŸ“‹ Implementation Plan` comment\n2. Follow a structured format that can be transformed to prd.json\n3. Trigger the approval â†’ prd.json â†’ /implement flow\n\nThis ensures the memory system \\(GitHub comments\\) captures the plan, and the implementation loop has proper state.\n\n## Requirements\n\n### 1. Define structured plan format\nPlans written during plan mode must follow this structure:\n```markdown\n# Implementation Plan: Issue #N - {title}\n\n## Overview\n{2-3 sentence approach}\n\n## Tasks\n\n### US-001: {title}\n**Priority:** 1\n**Files:** `path/to/file.ts`\n**Depends On:** None\n\n**Description:**\n{2-3 sentences}\n\n**Acceptance Criteria:**\n- [ ] {Verifiable criterion}\n\n**Verify Commands:**\n\\\\`\\\\`\\\\`bash\ncommand here\n\\\\`\\\\`\\\\`\n```\n\n### 2. Update `/issue` command Step 4\n- **4a:** Enter plan mode \\(existing\\)\n- **4b \\(NEW\\):** Post plan to GitHub as `## ðŸ“‹ Implementation Plan` comment\n- **4c:** Ask for approval\n- **4d:** Transform plan â†’ prd.json on approval\n- **4e:** Post `## âœ… Plan Approved` comment\n- **4f:** Prompt for `/implement`\n\n### 3. Add transformation logic\nParse the structured plan format and generate valid prd.json.\n\n## Acceptance Criteria\n- [ ] Plan format is documented in planning-guide.md\n- [ ] `/issue N` posts implementation plan comment to GitHub\n- [ ] `/issue N` generates prd.json from structured plan on approval\n- [ ] `/issue N` prompts user to run `/implement` after approval\n\n## Files to Modify\n- `.claude/commands/issue.md` - Update Step 4 flow\n- `.claude/rules/planning-guide.md` - Document required plan format\n\n## Out of Scope\n- Changes to `/implement` command\n- Changes to Pipedream automation\nEOF\n\\)\")",
      "Bash(git commit:*)",
      "Bash(gh issue comment:*)",
      "Bash(gh issue edit:*)",
      "Bash([ -f prd.json ])",
      "Bash(git checkout:*)",
      "Bash(gh pr create:*)",
      "Bash(gh issue close:*)",
      "WebSearch",
      "WebFetch(domain:www.anthropic.com)",
      "WebFetch(domain:claudelog.com)",
      "Bash(gh issue comment 6 --body \"$\\(cat <<''EOF''\n## ðŸ“‹ Implementation Plan\n\n**Issue:** #6 - Custom Planning Protocol\n**Generated:** 2026-02-02\n**Status:** Approved\n**Complexity:** Medium \\(4 tasks across 2 phases\\)\n\n---\n\n### Overview\nReplace native `EnterPlanMode`/`ExitPlanMode` with a custom 5-phase planning protocol that integrates seamlessly with our workflow. Uses `AskUserQuestion` for checkpoints, posts to GitHub at key phases, and generates prd.json on approval.\n\n---\n\n### Phase 1: Foundation\n\n#### US-001: Create custom planning protocol document\n**Files:** `.claude/rules/custom-planning-protocol.md`\n**Depends on:** None\n\nCreate the full protocol specification defining all 5 phases:\n- Phase 1: Exploration\n- Phase 2: Task Decomposition\n- Phase 3: Design Validation\n- Phase 4: GitHub Posting\n- Phase 5: prd.json Generation\n\n#### US-002: Update /issue command Step 4\n**Files:** `.claude/commands/issue.md`\n**Depends on:** US-001\n\nReplace EnterPlanMode/ExitPlanMode with custom protocol reference.\n\n---\n\n### Phase 2: Enhancements\n\n#### US-003: Add Discovery Summary template\n**Files:** `.claude/rules/custom-planning-protocol.md`\n**Depends on:** US-001\n\nStructured template for Phase 1 output.\n\n#### US-004: Add validation checks to Phase 3\n**Files:** `.claude/rules/custom-planning-protocol.md`\n**Depends on:** US-001\n\nSpecific validation checks for task quality.\n\n---\n\n### Task Dependencies\n```\nUS-001 \\(Priority 1\\)\n   â”œâ”€â†’ US-002 \\(Priority 2\\)\n   â”œâ”€â†’ US-003 \\(Priority 3\\)\n   â””â”€â†’ US-004 \\(Priority 4\\)\n```\nEOF\n\\)\")",
      "Bash(test:*)",
      "Bash(! grep -q 'EnterPlanMode' .claude/commands/issue.md)",
      "Bash(if grep -q 'EnterPlanMode' .claude/commands/issue.md)",
      "Bash(then echo \"âŒ EnterPlanMode still exists\")",
      "Bash(else echo \"âœ“ No EnterPlanMode references\")",
      "Bash(fi)",
      "Bash(if grep -q 'ExitPlanMode' .claude/commands/issue.md)",
      "Bash(then echo \"âŒ ExitPlanMode still exists\")",
      "Bash(else echo \"âœ“ No ExitPlanMode references\")",
      "Bash(gh issue create --title \"Bug: /implement does not run implement-loop.sh script\" --body \"$\\(cat <<''EOF''\n## Description\n\nThe `/implement` command documentation specifies that the default behavior should launch `.claude/scripts/implement-loop.sh` in the background for autonomous task execution. However, when `/implement` is invoked, Claude executes tasks interactively in the conversation instead of running the script.\n\n## Expected Behavior\n\n```\n/implement              # Should launch background script \\(DEFAULT\\)\n/implement single       # Should execute ONE task interactively\n```\n\nWhen running `/implement` \\(no arguments\\), the script should be launched:\n```bash\nnohup .claude/scripts/implement-loop.sh > /dev/null 2>&1 &\n```\n\n## Actual Behavior\n\nClaude reads the `/implement` command instructions but then proceeds to execute tasks directly in the conversation, bypassing the script entirely.\n\n## Root Cause\n\nThe command documentation tells Claude what to do, but there''s no enforcement mechanism. Claude chooses to do the work interactively rather than launching the script.\n\n## Proposed Solutions\n\n1. **Stronger language** - Add explicit \"You MUST run the script, do NOT execute tasks interactively\" to the command\n2. **Script check first** - Command should verify script exists and launch it BEFORE any task analysis\n3. **Refuse without script** - Default `/implement` should refuse to proceed if it can''t launch the script\n\n## Files Affected\n\n- `.claude/commands/implement.md` - Command instructions need strengthening\n- `.claude/scripts/implement-loop.sh` - Script exists but isn''t being invoked\n\n## Acceptance Criteria\n\n- [ ] Running `/implement` \\(no args\\) launches the background script\n- [ ] Running `/implement single` executes one task interactively\n- [ ] Clear error if script doesn''t exist when running default mode\nEOF\n\\)\")"
    ]
  }
}
